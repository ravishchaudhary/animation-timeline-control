!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.timelineModule=t():e.timelineModule=t()}(self,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,r(o.key),o)}}function r(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}e.r(t),e.d(t,{Timeline:()=>Ve,TimelineCapShape:()=>ge,TimelineClickEvent:()=>se,TimelineCursorType:()=>me,TimelineDragEvent:()=>he,TimelineDraggableData:()=>T,TimelineElementType:()=>w,TimelineEventSource:()=>F,TimelineEvents:()=>Se,TimelineEventsEmitter:()=>i,TimelineInteractionMode:()=>pe,TimelineKeyframeChangedEvent:()=>K,TimelineKeyframeShape:()=>l,TimelineScrollSource:()=>we,TimelineSelectedEvent:()=>ee,TimelineSelectionMode:()=>be,TimelineStyleUtils:()=>S,TimelineTimeChangedEvent:()=>G,TimelineUtils:()=>f,defaultGroupStyle:()=>_,defaultRowHeight:()=>v,defaultTimelineConsts:()=>ke,defaultTimelineKeyframeStyle:()=>y,defaultTimelineOptions:()=>xe,defaultTimelineRowStyle:()=>h,defaultTimelineStyle:()=>Ce});var i=function(){return e=function e(){var t,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,o=[],(n=r(n="_subscriptions"))in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o},(t=[{key:"on",value:function(e,t){return!!t&&(this._subscriptions.push({topic:e,callback:t}),!0)}},{key:"off",value:function(e,t){var n=this._subscriptions.length;return this._subscriptions=this._subscriptions.filter(function(n){return n&&n.callback!=t&&n.topic!=e}),n!==this._subscriptions.length}},{key:"offAll",value:function(){this._subscriptions.length=0}},{key:"emit",value:function(e,t){this._subscriptions.forEach(function(n){(null==n?void 0:n.topic)===e&&null!=n&&n.callback&&n.callback(t)})}}])&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),l=function(e){return e.None="none",e.Rhomb="rhomb",e.Circle="circle",e.Rect="rect",e}({});function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,c(o.key),o)}}function u(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}var d=[1,2,5,10],f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,n=[{key:"drawLine",value:function(e,t,n,o,r){e.moveTo(t,n),e.lineTo(o,r)}},{key:"isNumber",value:function(e){return!("number"!=typeof e||!e&&0!==e||isNaN(e)||!Number.isFinite(e))}},{key:"deleteElement",value:function(e,t){var n=e.indexOf(t);return-1!==n?e.splice(n,1):e}},{key:"isOverlap",value:function(e,t,n){return!!n&&n.x<=e&&n.x+n.width>=e&&n.y<=t&&n.y+n.height>=t}},{key:"findGoodStep",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d;if(o||(o=d),t<=0||isNaN(t)||!Number.isFinite(t))return t;for(var r=t,i=null,l=e.getPowArgument(t),a=0;a<o.length;a++){var s=o[a]*Math.pow(10,l);if(!n||n%s==0){var u=e.getDistance(t,s);if(0==u||u<=.1&&l>0){i=u,r=s;break}(!i||i>u)&&(i=u,r=s)}}return r}},{key:"keepInBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.isNumber(t)&&(e.isNumber(n)&&(n||0===n)&&(t=Math.max(t,n)),e.isNumber(o)&&(o||0===o)&&(t=Math.min(t,o))),t}},{key:"setMinMax",value:function(t,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!n||!t)return t;var r=n?n.min:Number.NaN,i=t.min,l=(r||0===r)&&e.isNumber(r),a=(i||0===i)&&e.isNumber(i);l&&a?t.min=o?Math.min(r,i):Math.max(r,i):l&&(t.min=r);var s=n?n.max:Number.NaN,u=t.max,c=(s||0===s)&&e.isNumber(s),d=(u||0===u)&&e.isNumber(u);return c&&d?t.max=o?Math.max(s,u):Math.min(s,u):c&&(t.max=s),t}},{key:"shrinkSelf",value:function(e,t){return e?(e.x-=t,e.y-=t,e.width+=t,e.height+=t,e):e}},{key:"isRectIntersects",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!t)return console.log("Rectangles cannot be empty"),!1;var o=t.x+t.width,r=t.y+t.height;return n?e.x<=o&&t.x<=e.x+e.width&&e.y<=r&&t.y<=e.y+e.height:e.x<o&&t.x<e.x+e.width&&e.y<r&&t.y<e.y+e.height}},{key:"getDistance",value:function(e,t,n,o){return null!=n&&null!=o?Math.sqrt(Math.pow(e-n,2)+Math.pow(t-o,2)):Math.abs(e-t)}},{key:"sign",value:function(e){return e>=0?1:-1}},{key:"clearBrowserSelection",value:function(){if(window)if(window.getSelection){var e=window.getSelection();e&&e.removeAllRanges()}else{var t=window.document;t.selection&&t.selection.empty()}}},{key:"getPowArgument",value:function(e){if(!e||0===e||!isFinite(e))return 1;if(e>=10&&e<100)return 1;if(e>=100&&e<1e3)return 2;if(e>=1e3&&e<1e4)return 3;e=Math.abs(e);var t=0,n=this.sign(e);if(e>1){for(;e>=1;)e=Math.floor(e/10),t++;return n*t-1}return e>0?Math.floor(Math.log(e)/Math.log(10)+1)-1:1}},{key:"mergeOptions",value:function(t,n){n=n||{};var o=e.cloneOptions(t),r=function(e,t){if(e&&t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&void 0!==t[n]&&("object"===a(t[n])?"id"===n?t[n]&&t[n]!==e[n]&&(e[n]=t[n]):e[n]?r(e[n],t[n]):e[n]=t[n]:e[n]=t[n])};return r(o,n),o}},{key:"timePadZero",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=String(e),o=Math.pow(10,t-1);if(e<o)for(;String(o).length>n.length;)n="0".concat(e);return n}}],null&&s(t.prototype,null),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();u(f,"deepClone",function(e){return JSON.parse(JSON.stringify(e))}),u(f,"cloneOptions",function(e){var t=JSON.parse(JSON.stringify(e,function(e,t){return"id"===e?void 0:t}));return t.id=e.id,t});var v=24,_={height:"auto",marginTop:4,fillColor:"#094771"},y={fillColor:"DarkOrange",shape:l.Rhomb,selectedFillColor:"red",strokeColor:"black",selectedStrokeColor:"black",strokeThickness:.2,height:"auto",width:"auto"},h={height:v,marginBottom:2,fillColor:"#252526",keyframesStyle:y,groupsStyle:_};function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,m(o.key),o)}}function m(e){var t=function(e){if("object"!=g(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==g(t)?t:t+""}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}var b="undefined",S=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,n=[{key:"getGroup",value:function(e){return e&&"string"==typeof e?null:e||null}},{key:"getGroupStyle",value:function(t){var n;return(null===(n=e.getGroup(t))||void 0===n?void 0:n.style)||null}},{key:"getFirstSet",value:function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return e.getValue.apply(e,[t,!1].concat(o))}},{key:"getValue",value:function(t){for(var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=[],r=!1,i=arguments.length,l=new Array(i>2?i-2:0),a=2;a<i;a++)l[a-2]=arguments[a];l.forEach(function(e){if(!r&&g(e)!==b){if("number"==typeof e){if(!f.isNumber(e))return}else{if("boolean"==typeof e)return o.push(e),void(n&&!1===e&&(r=!0));if(!e)return}o.push(e)}});var s=o&&o.length>0?o[0]:t;return!r&&e.getValueOrDefault(s,t)}},{key:"getValueOrDefault",value:function(e,t){return g(e)===b?t:"boolean"==typeof e?e:"number"==typeof e?e||0===e?e:t:e||t}},{key:"keyframeWidth",value:function(t,n,o,r){var i,l,a,s,u,c;return e.getFirstSet(y.width||"",null==t||null===(i=t.style)||void 0===i?void 0:i.width,null===(l=e.getGroupStyle(n))||void 0===l||null===(l=l.keyframesStyle)||void 0===l?void 0:l.width,null==o||null===(a=o.keyframesStyle)||void 0===a?void 0:a.width,null==o||null===(s=o.groupsStyle)||void 0===s||null===(s=s.keyframesStyle)||void 0===s?void 0:s.width,null==r||null===(u=r.rowsStyle)||void 0===u||null===(u=u.groupsStyle)||void 0===u||null===(u=u.keyframesStyle)||void 0===u?void 0:u.width,null==r||null===(c=r.rowsStyle)||void 0===c||null===(c=c.keyframesStyle)||void 0===c?void 0:c.width)}},{key:"keyframeHeight",value:function(t,n,o,r){var i,l,a,s,u,c;return e.getFirstSet(y.height||"",null==t||null===(i=t.style)||void 0===i?void 0:i.height,null===(l=e.getGroupStyle(n))||void 0===l||null===(l=l.keyframesStyle)||void 0===l?void 0:l.height,null==o||null===(a=o.keyframesStyle)||void 0===a?void 0:a.height,null==o||null===(s=o.groupsStyle)||void 0===s||null===(s=s.keyframesStyle)||void 0===s?void 0:s.height,null==r||null===(u=r.rowsStyle)||void 0===u||null===(u=u.groupsStyle)||void 0===u||null===(u=u.keyframesStyle)||void 0===u?void 0:u.height,null==r||null===(c=r.rowsStyle)||void 0===c||null===(c=c.keyframesStyle)||void 0===c?void 0:c.height)}},{key:"keyframeShape",value:function(t,n,o,r){var i,a,s,u,c,d,f=y.shape||l.Rhomb;return e.getFirstSet(f,null==t||null===(i=t.style)||void 0===i?void 0:i.shape,null===(a=e.getGroupStyle(n))||void 0===a||null===(a=a.keyframesStyle)||void 0===a?void 0:a.shape,null==o||null===(s=o.groupsStyle)||void 0===s||null===(s=s.keyframesStyle)||void 0===s?void 0:s.shape,null==o||null===(u=o.keyframesStyle)||void 0===u?void 0:u.shape,n?null==r||null===(c=r.rowsStyle)||void 0===c||null===(c=c.groupsStyle)||void 0===c||null===(c=c.keyframesStyle)||void 0===c?void 0:c.shape:void 0,null==r||null===(d=r.rowsStyle)||void 0===d||null===(d=d.keyframesStyle)||void 0===d?void 0:d.shape)}},{key:"keyframeFillColor",value:function(t,n,o,r){var i,l,a,s,u,c,d=y.fillColor||"";return e.getFirstSet(d,null==t||null===(i=t.style)||void 0===i?void 0:i.fillColor,null===(l=e.getGroupStyle(n))||void 0===l||null===(l=l.keyframesStyle)||void 0===l?void 0:l.fillColor,null==o||null===(a=o.groupsStyle)||void 0===a||null===(a=a.keyframesStyle)||void 0===a?void 0:a.fillColor,null==o||null===(s=o.keyframesStyle)||void 0===s?void 0:s.fillColor,n?null==r||null===(u=r.rowsStyle)||void 0===u||null===(u=u.groupsStyle)||void 0===u||null===(u=u.keyframesStyle)||void 0===u?void 0:u.fillColor:void 0,null==r||null===(c=r.rowsStyle)||void 0===c||null===(c=c.keyframesStyle)||void 0===c?void 0:c.fillColor)}},{key:"keyframeSelectedFillColor",value:function(t,n,o,r){var i,l,a,s,u,c,d=y.selectedFillColor||"";return e.getFirstSet(d,null==t||null===(i=t.style)||void 0===i?void 0:i.selectedFillColor,null===(l=e.getGroupStyle(n))||void 0===l||null===(l=l.keyframesStyle)||void 0===l?void 0:l.selectedFillColor,null==o||null===(a=o.groupsStyle)||void 0===a||null===(a=a.keyframesStyle)||void 0===a?void 0:a.selectedFillColor,null==o||null===(s=o.keyframesStyle)||void 0===s?void 0:s.selectedFillColor,n?null==r||null===(u=r.rowsStyle)||void 0===u||null===(u=u.groupsStyle)||void 0===u||null===(u=u.keyframesStyle)||void 0===u?void 0:u.selectedFillColor:void 0,null==r||null===(c=r.rowsStyle)||void 0===c||null===(c=c.keyframesStyle)||void 0===c?void 0:c.selectedFillColor)}},{key:"keyframeStrokeThickness",value:function(t,n,o,r){var i,l,a,s,u,c,d=y.strokeThickness||0;return e.getFirstSet(d,null==t||null===(i=t.style)||void 0===i?void 0:i.strokeThickness,null===(l=e.getGroupStyle(n))||void 0===l||null===(l=l.keyframesStyle)||void 0===l?void 0:l.strokeThickness,null==o||null===(a=o.groupsStyle)||void 0===a||null===(a=a.keyframesStyle)||void 0===a?void 0:a.strokeThickness,null==o||null===(s=o.keyframesStyle)||void 0===s?void 0:s.strokeThickness,n?null==r||null===(u=r.rowsStyle)||void 0===u||null===(u=u.groupsStyle)||void 0===u||null===(u=u.keyframesStyle)||void 0===u?void 0:u.strokeThickness:void 0,null==r||null===(c=r.rowsStyle)||void 0===c||null===(c=c.keyframesStyle)||void 0===c?void 0:c.strokeThickness)}},{key:"keyframeStrokeColor",value:function(t,n,o,r){var i,l,a,s,u,c,d=y.strokeColor||"";return e.getFirstSet(d,null==t||null===(i=t.style)||void 0===i?void 0:i.strokeColor,null===(l=e.getGroupStyle(n))||void 0===l||null===(l=l.keyframesStyle)||void 0===l?void 0:l.strokeColor,null==o||null===(a=o.groupsStyle)||void 0===a||null===(a=a.keyframesStyle)||void 0===a?void 0:a.strokeColor,null==o||null===(s=o.keyframesStyle)||void 0===s?void 0:s.strokeColor,n?null==r||null===(u=r.rowsStyle)||void 0===u||null===(u=u.groupsStyle)||void 0===u||null===(u=u.keyframesStyle)||void 0===u?void 0:u.strokeColor:void 0,null==r||null===(c=r.rowsStyle)||void 0===c||null===(c=c.keyframesStyle)||void 0===c?void 0:c.strokeColor)}},{key:"keyframeSelectedStrokeColor",value:function(t,n,o,r){var i,l,a,s,u,c,d=y.selectedStrokeColor||"";return e.getFirstSet(d,null==t||null===(i=t.style)||void 0===i?void 0:i.selectedStrokeColor,null===(l=e.getGroupStyle(n))||void 0===l||null===(l=l.keyframesStyle)||void 0===l?void 0:l.selectedStrokeColor,null==o||null===(a=o.groupsStyle)||void 0===a||null===(a=a.keyframesStyle)||void 0===a?void 0:a.selectedStrokeColor,null==o||null===(s=o.keyframesStyle)||void 0===s?void 0:s.selectedStrokeColor,n?null==r||null===(u=r.rowsStyle)||void 0===u||null===(u=u.groupsStyle)||void 0===u||null===(u=u.keyframesStyle)||void 0===u?void 0:u.selectedStrokeColor:void 0,null==r||null===(c=r.rowsStyle)||void 0===c||null===(c=c.keyframesStyle)||void 0===c?void 0:c.selectedStrokeColor)}},{key:"groupHeight",value:function(t,n,o){var r,i,l;return e.getFirstSet(_.height||"auto",null===(r=e.getGroupStyle(n))||void 0===r?void 0:r.height,null==o||null===(i=o.groupsStyle)||void 0===i?void 0:i.height,null==t||null===(l=t.rowsStyle)||void 0===l||null===(l=l.groupsStyle)||void 0===l?void 0:l.height)}},{key:"groupMarginTop",value:function(t,n,o){var r,i,l;return e.getFirstSet(_.marginTop||"auto",null===(r=e.getGroupStyle(n))||void 0===r?void 0:r.marginTop,null==o||null===(i=o.groupsStyle)||void 0===i?void 0:i.marginTop,null==t||null===(l=t.rowsStyle)||void 0===l||null===(l=l.groupsStyle)||void 0===l?void 0:l.marginTop)}},{key:"groupFillColor",value:function(t,n,o){var r,i,l;return e.getFirstSet(_.fillColor||"",null===(r=e.getGroupStyle(n))||void 0===r?void 0:r.fillColor,null==o||null===(i=o.groupsStyle)||void 0===i?void 0:i.fillColor,null==t||null===(l=t.rowsStyle)||void 0===l||null===(l=l.groupsStyle)||void 0===l?void 0:l.fillColor)}},{key:"groupStrokeColor",value:function(t,n,o){var r,i,l;return e.getFirstSet(_.strokeColor||"",null===(r=e.getGroupStyle(n))||void 0===r?void 0:r.strokeColor,null==o||null===(i=o.groupsStyle)||void 0===i?void 0:i.strokeColor,null==t||null===(l=t.rowsStyle)||void 0===l||null===(l=l.groupsStyle)||void 0===l?void 0:l.strokeColor)}},{key:"groupStrokeThickness",value:function(t,n,o){var r,i,l;return e.getFirstSet(_.strokeThickness||"",null===(r=e.getGroupStyle(n))||void 0===r?void 0:r.strokeThickness,null==o||null===(i=o.groupsStyle)||void 0===i?void 0:i.strokeThickness,null==t||null===(l=t.rowsStyle)||void 0===l||null===(l=l.groupsStyle)||void 0===l?void 0:l.strokeThickness)||0}},{key:"groupsRadii",value:function(t,n,o){var r,i,l;return e.getFirstSet(_.radii||"",null===(r=e.getGroupStyle(n))||void 0===r?void 0:r.radii,null==o||null===(i=o.groupsStyle)||void 0===i?void 0:i.radii,null==t||null===(l=t.rowsStyle)||void 0===l||null===(l=l.groupsStyle)||void 0===l?void 0:l.radii)||0}},{key:"getRowHeight",value:function(t,n){var o,r=h.height||0;return e.getFirstSet(r,null==t?void 0:t.height,null==n||null===(o=n.rowsStyle)||void 0===o?void 0:o.height)}},{key:"getRowMarginBottom",value:function(t,n){var o,r=h.marginBottom||0;return e.getFirstSet(r,null==t?void 0:t.marginBottom,null==n||null===(o=n.rowsStyle)||void 0===o?void 0:o.marginBottom)}},{key:"getRowFillColor",value:function(t,n){var o,r=h.fillColor||"";return e.getFirstSet(r,null==t?void 0:t.fillColor,null==n||null===(o=n.rowsStyle)||void 0===o?void 0:o.fillColor)}},{key:"headerHeight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;return(null==e?void 0:e.headerHeight)||t}},{key:"keyframeDraggable",value:function(t,n,o,r){var i,l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return e.getValue(l,!0,null==t?void 0:t.draggable,null===(i=e.getGroup(n))||void 0===i?void 0:i.keyframesDraggable,null==o?void 0:o.keyframesDraggable,null==r?void 0:r.keyframesDraggable)}},{key:"groupDraggable",value:function(t,n,o){var r;return e.getValue(!0,!0,null===(r=e.getGroup(t))||void 0===r?void 0:r.draggable,null==n?void 0:n.groupsDraggable,null==o?void 0:o.groupsDraggable)}}],null&&p(t.prototype,null),n&&p(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}(),w=function(e){return e.Timeline="timeline",e.DurationLine="durationLine",e.Keyframe="keyframe",e.Group="group",e.Row="row",e.None="none",e}({});function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,P(o.key),o)}}function x(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function M(e,t,n){return(t=P(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e){var t=function(e){if("object"!=k(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==k(t)?t:t+""}var T=x(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),M(this,"changed",!1),M(this,"target",void 0),M(this,"elements",void 0),M(this,"type",w.None),M(this,"val",void 0),M(this,"prevVal",void 0)});function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function D(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,O(o.key),o)}}function O(e){var t=function(e){if("object"!=E(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==E(t)?t:t+""}var R=function(){return e=function e(){var t,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,o=!1,(n=O(n="_prevented"))in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o},(t=[{key:"preventDefault",value:function(){this._prevented=!0}},{key:"isPrevented",value:function(){return this._prevented}}])&&D(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function N(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(N=function(){return!!e})()}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}function V(e,t){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},V(e,t)}function L(e,t,n){return(t=A(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){var t=function(e){if("object"!=j(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==j(t)?t:t+""}var K=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return L(e=function(e,t,n){return t=z(t),function(e,t){if(t&&("object"==j(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,N()?Reflect.construct(t,n||[],z(e).constructor):t.apply(e,n))}(this,t,[].concat(o)),"val",void 0),L(e,"prevVal",void 0),L(e,"target",void 0),L(e,"source",void 0),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&V(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(R),F=function(e){return e.User="user",e.Programmatically="programmatically",e.SetTimeMethod="setTimeMethod",e}({});function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function B(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(B=function(){return!!e})()}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}function Z(e,t,n){return(t=U(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(e){var t=function(e){if("object"!=W(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=W(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==W(t)?t:t+""}var G=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return Z(e=function(e,t,n){return t=I(t),function(e,t){if(t&&("object"==W(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,B()?Reflect.construct(t,n||[],I(e).constructor):t.apply(e,n))}(this,t,[].concat(o)),"val",0),Z(e,"prevVal",0),Z(e,"source",F.User),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(R),Y=function(e){return e.Keyframes="keyframes",e}({});function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function J(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Q(o.key),o)}}function q(e,t,n){return t&&J(e.prototype,t),n&&J(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function $(e,t,n){return(t=Q(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e){var t=function(e){if("object"!=X(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=X(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==X(t)?t:t+""}var ee=q(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$(this,"selected",[]),$(this,"changed",[]),$(this,"mode",Y.Keyframes)});function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ne(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ae(o.key),o)}}function oe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(oe=function(){return!!e})()}function re(e){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},re(e)}function ie(e,t){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ie(e,t)}function le(e,t,n){return(t=ae(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ae(e){var t=function(e){if("object"!=te(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==te(t)?t:t+""}var se=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return le(e=function(e,t,n){return t=re(t),function(e,t){if(t&&("object"==te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,oe()?Reflect.construct(t,n||[],re(e).constructor):t.apply(e,n))}(this,t,[].concat(o)),"args",null),le(e,"elements",[]),le(e,"target",null),le(e,"point",null),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ie(e,t)}(t,e),n=t,(o=[{key:"pos",get:function(){var e;return(null===(e=this.point)||void 0===e?void 0:e.pos)||null}},{key:"val",get:function(){return this.point?this.point.val:NaN}}])&&ne(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(R);function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function ce(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ye(o.key),o)}}function de(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(de=function(){return!!e})()}function fe(e){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fe(e)}function ve(e,t){return ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ve(e,t)}function _e(e,t,n){return(t=ye(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ye(e){var t=function(e){if("object"!=ue(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ue(t)?t:t+""}var he=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return _e(e=function(e,t,n){return t=fe(t),function(e,t){if(t&&("object"==ue(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,de()?Reflect.construct(t,n||[],fe(e).constructor):t.apply(e,n))}(this,t,[].concat(o)),"args",null),_e(e,"elements",null),_e(e,"target",null),_e(e,"point",null),_e(e,"prevPoint",null),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ve(e,t)}(t,e),n=t,(o=[{key:"pos",get:function(){var e;return(null===(e=this.point)||void 0===e?void 0:e.pos)||null}}])&&ce(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(R),pe=function(e){return e.Selection="selection",e.Pan="pan",e.NonInteractivePan="nonInteractivePan",e.Zoom="zoom",e.None="none",e}({}),me=function(e){return e.Alias="alias",e.AllScroll="all-scroll",e.Auto="auto",e.Cell="cell",e.ContextMenu="context-menu",e.ColResize="col-resize",e.Copy="copy",e.Crosshair="crosshair",e.Default="default",e.EResize="e-resize",e.EWResize="ew-resize",e.Grab="grab",e.Grabbing="grabbing",e.Help="help",e.Move="move",e.NResize="n-resize",e.NEResize="ne-resize",e.NESWResize="nesw-resize",e.NSResize="ns-resize",e.NWResize="nw-resize",e.NWSEResize="nwse-resize",e.NoDrop="no-drop",e.None="none",e.NotAllowed="not-allowed",e.Pointer="pointer",e.Progress="progress",e.RowResize="row-resize",e.SResize="s-resize",e.SEResize="se-resize",e.SWResize="sw-resize",e.Text="text",e.WResize="w-resize",e.Wait="wait",e.ZoomIn="zoom-in",e.ZoomOut="zoom-out",e}({}),ge=function(e){return e.None="none",e.Triangle="triangle",e.Rect="rect",e}({}),be=function(e){return e.Normal="normal",e.Append="append",e.Revert="revert",e}({}),Se=function(e){return e.Selected="selected",e.TimeChanged="timechanged",e.DurationChanged="durationChanged",e.KeyframeChanged="keyframeChanged",e.DragStarted="dragStarted",e.Drag="drag",e.DragFinished="dragFinished",e.Scroll="scroll",e.ScrollFinished="scrollFinished",e.ContextMenu="onContextMenu",e.DoubleClick="doubleClick",e.MouseDown="mouseDown",e.KeyDown="keyDown",e.KeyUp="keyUp",e.KeyPress="keyPress",e.ZoomChanged="zoomChanged",e}({}),we=function(e){return e.DefaultMode="none",e.ZoomMode="zoom",e.ScrollBySelection="scrollBySelection",e}({}),ke={autoPanSpeed:50,scrollByDragSpeed:.12,clickDetectionMs:120,doubleClickTimeoutMs:400,scrollFinishedTimeoutMs:500,autoPanByScrollPadding:10,clickThreshold:3,clickDetectionMinRadius:2,autoPanSpeedLimit:10,defaultGroupHeight:.7},Ce={width:2,marginTop:15,marginBottom:0,strokeColor:"DarkOrange",fillColor:"DarkOrange",capStyle:{width:4,height:10,capType:ge.Rect,strokeColor:"DarkOrange",fillColor:"DarkOrange"},cursor:me.EWResize},xe={snapAllKeyframesOnMove:!1,snapEnabled:!0,timelineStyle:Ce,stepPx:120,stepVal:1e3,stepSmallPx:30,snapStep:200,leftMargin:25,headerFillColor:"#101011",fillColor:"#101011",labelsColor:"#D5D5D5",tickColor:"#D5D5D5",selectionColor:"White",rowsStyle:h,keyframesStyle:y,groupsStyle:_,headerHeight:30,font:"11px sans-serif",zoom:1,zoomSpeed:.1,zoomMin:.1,zoomMax:8,controlKeyIsMetaKey:!1,scrollContainerClass:"scroll-container",groupsDraggable:!0,keyframesDraggable:!0,timelineDraggable:!0,min:0,max:Number.MAX_VALUE,totalDuration:1e4};function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function Te(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ze(o.key),o)}}function Ee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ee=function(){return!!e})()}function De(e,t){return De=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},De(e,t)}function Oe(e,t,n,o){var r=Re(je(1&o?e.prototype:e),t,n);return 2&o&&"function"==typeof r?function(e){return r.apply(n,e)}:r}function Re(){return Re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=je(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},Re.apply(null,arguments)}function je(e){return je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},je(e)}function Ne(e,t,n){return(t=ze(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ze(e){var t=function(e){if("object"!=Me(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Me(t)?t:t+""}var Ve=function(e){function t(){var e,n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ne(n=function(e,t,n){return t=je(t),function(e,t){if(t&&("object"==Me(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ee()?Reflect.construct(t,n||[],je(e).constructor):t.apply(e,n))}(this,t),"_container",null),Ne(n,"_canvas",null),Ne(n,"_scrollContainer",null),Ne(n,"_scrollContent",null),Ne(n,"_ctx",null),Ne(n,"_options",void 0),Ne(n,"_startPosMouseArgs",null),Ne(n,"_scrollStartPos",null),Ne(n,"_currentPos",null),Ne(n,"_selectionRect",null),Ne(n,"_selectionRectEnabled",!1),Ne(n,"_drag",null),Ne(n,"_startedDragWithCtrl",!1),Ne(n,"_startedDragWithShiftKey",!1),Ne(n,"_scrollProgrammatically",!1),Ne(n,"_clickTimeout",null),Ne(n,"_lastClickTime",0),Ne(n,"_lastClickPoint",null),Ne(n,"_consts",ke),Ne(n,"_clickAllowed",!1),Ne(n,"_scrollFinishedTimerRef",null),Ne(n,"_val",0),Ne(n,"_durationVal",0),Ne(n,"_pixelRatio",1),Ne(n,"_currentZoom",0),Ne(n,"_intervalRef",null),Ne(n,"_autoPanLastActionDate",0),Ne(n,"_isPanStarted",!1),Ne(n,"_interactionMode",pe.Selection),Ne(n,"_lastUsedArgs",null),Ne(n,"_model",null),Ne(n,"_scrollAreaClickOrDragStarted",!1),Ne(n,"initialize",function(e,t){if(n._model=t,!e||!e.id)throw new Error("Element cannot be empty. Should be string or DOM element.");n._generateContainers(e.id),n._options=f.cloneOptions(xe),e&&(n._options=n._setOptions(e)),n._subscribeComponentEvents(),n.rescale(),n.redraw()}),Ne(n,"_generateContainers",function(e){if(e instanceof HTMLElement?n._container=e:n._container=document.getElementById(e),!n._container)throw new Error("Element cannot be empty. Should be string or DOM element.");if(n._scrollContainer=document.createElement("div"),n._scrollContent=document.createElement("div"),n._canvas=document.createElement("canvas"),n._canvas&&n._canvas.getContext){n._container.innerHTML="",n._container.style.position="relative",n._canvas.style.cssText="image-rendering: -moz-crisp-edges;image-rendering: -webkit-crisp-edges;image-rendering: pixelated;image-rendering: crisp-edges;user-select: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-o-user-select: none;user-select: none;touch-action: none;position: relative;-webkit-user-drag: none;-khtml-user-drag: none;-moz-user-drag: none;-o-user-drag: none;user-drag: none;padding: inherit",n._scrollContainer.style.cssText="overflow: scroll;position: absolute;width:  100%;height:  100%;",n._scrollContent.style.width=n._scrollContent.style.height="100%",n._scrollContainer.appendChild(n._scrollContent),n._container.appendChild(n._scrollContainer);var t=n._scrollContainer.offsetWidth-n._scrollContent.clientWidth;n._canvas.style.width=n._canvas.style.height="calc(100% -"+(t||17)+"px)",n._container.appendChild(n._canvas),n._ctx=n._getCtx()}else console.log("Cannot initialize canvas context.")}),Ne(n,"_subscribeComponentEvents",function(){if(n._unsubscribeComponentEvents(),!n._container||!n._scrollContainer||!n._canvas)throw Error("Cannot subscribe on scroll events while one of the containers is null or empty. Please call initialize method first");n._container&&n._container.addEventListener("wheel",n._handleWheelEvent),n._scrollContainer&&(n._scrollContainer.addEventListener("scroll",n._handleScrollEvent),n._scrollContainer.addEventListener("touchstart",n._handleScrollMouseDownEvent),n._scrollContainer.addEventListener("mousedown",n._handleScrollMouseDownEvent)),document.addEventListener("keyup",n._handleKeyUp,!1),document.addEventListener("keydown",n._handleKeyDown,!1),window.addEventListener("blur",n._handleBlurEvent,!1),window.addEventListener("resize",n._handleWindowResizeEvent,!1),n._canvas&&(n._canvas.addEventListener("touchstart",n._handleMouseDownEvent,!1),n._canvas.addEventListener("mousedown",n._handleMouseDownEvent,!1),n._canvas.addEventListener("contextmenu",n._handleContextMenu,!1)),window.addEventListener("mousemove",n._handleMouseMoveEvent,!1),window.addEventListener("touchmove",n._handleMouseMoveEvent,!1),window.addEventListener("mouseup",n._handleMouseUpEvent,!1),window.addEventListener("touchend",n._handleMouseUpEvent,!1)}),Ne(n,"_unsubscribeComponentEvents",function(){var e;null===(e=n._container)||void 0===e||e.removeEventListener("wheel",n._handleWheelEvent),n._scrollContainer?(n._scrollContainer.removeEventListener("scroll",n._handleScrollEvent),n._scrollContainer.removeEventListener("touchstart",n._handleScrollMouseDownEvent),n._scrollContainer.removeEventListener("mousedown",n._handleScrollMouseDownEvent)):console.warn("Cannot unsubscribe scroll while it's already empty"),window.removeEventListener("blur",n._handleBlurEvent),window.removeEventListener("resize",n._handleWindowResizeEvent),document.removeEventListener("keydown",n._handleKeyDown),document.removeEventListener("keyup",n._handleKeyUp),n._canvas?(n._canvas.removeEventListener("touchstart",n._handleMouseDownEvent),n._canvas.removeEventListener("mousedown",n._handleMouseDownEvent),n._canvas.removeEventListener("contextmenu",n._handleContextMenu)):console.warn("Cannot unsubscribe canvas while it's already empty"),window.removeEventListener("mousemove",n._handleMouseMoveEvent),window.removeEventListener("touchmove",n._handleMouseMoveEvent),window.removeEventListener("mouseup",n._handleMouseUpEvent),window.removeEventListener("touchend",n._handleMouseUpEvent)}),Ne(n,"dispose",function(){n.offAll(),n._stopAutoPan(),n._clearScrollFinishedTimer(),n._unsubscribeComponentEvents(),n._container&&(n._container.innerHTML=""),n._container=null,n._canvas=null,n._scrollContainer=null,n._scrollContent=null,n._ctx=null,n._cleanUpSelection()}),Ne(n,"_handleKeyUp",function(e){n._interactionMode===pe.Zoom&&n._setZoomCursor(e)}),Ne(n,"_handleKeyDown",function(e){n._interactionMode===pe.Zoom&&n._setZoomCursor(e),Oe(t,"emit",n,3)([Se.KeyDown,e])}),Ne(n,"_setZoomCursor",function(e){n._controlKeyPressed(e)?n._setCursor(me.ZoomOut):n._setCursor(me.ZoomIn)}),Ne(n,"_handleBlurEvent",function(){n._cleanUpSelection(!0)}),Ne(n,"_handleWindowResizeEvent",function(){n.rescale(),n.redraw()}),Ne(n,"_clearScrollFinishedTimer",function(){n._scrollFinishedTimerRef&&(clearTimeout(n._scrollFinishedTimerRef),n._scrollFinishedTimerRef=null)}),Ne(n,"_handleScrollMouseDownEvent",function(){n._scrollAreaClickOrDragStarted=!0}),Ne(n,"_handleScrollEvent",function(e){var t=n._scrollProgrammatically;n._scrollProgrammatically&&(n._scrollProgrammatically=!1),n._clearScrollFinishedTimer(),n._scrollFinishedTimerRef=window.setTimeout(function(){n._isPanStarted||(n._clearScrollFinishedTimer(),n.rescale(),n.redraw()),n._emitScrollEvent(e,t,Se.ScrollFinished)},n._consts.scrollFinishedTimeoutMs),n.redraw(),n._emitScrollEvent(e,t)}),Ne(n,"_controlKeyPressed",function(e){return n._options&&void 0!==n._options.controlKeyIsMetaKey?n._options.controlKeyIsMetaKey||n._options.controlKeyIsMetaKey?e.metaKey:e.ctrlKey:e.metaKey||e.ctrlKey}),Ne(n,"_handleWheelEvent",function(e){n._scrollContainer&&n._canvas&&(n._controlKeyPressed(e)?(e.preventDefault(),n._zoom(f.sign(e.deltaY),n._options.zoomSpeed||0,0)):(!0!==n._options.disableScrollY&&(n.scrollTop=n._scrollContainer.scrollTop+e.deltaY),n.scrollLeft=n._scrollContainer.scrollLeft+e.deltaX,e.preventDefault()))}),Ne(n,"_zoom",function(e,t,o){if(t&&t>0&&t<=1){var r=n._canvasClientWidth()/o,i=n._fromScreen(o),l=e*n._currentZoom*t,a=n._currentZoom;if(n._currentZoom=n._setZoom(n._currentZoom+l),n._currentZoom===a)return;var s=n.valToPx(i),u=Math.round(s-n._canvasClientWidth()/r);u<=0&&(u=0),n._rescaleInternal(u+n._canvasClientWidth(),null,we.ZoomMode),n.scrollLeft=u,n.redraw()}}),Ne(n,"zoomIn",function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n._options.zoomSpeed,o=(null===(e=n._scrollContainer)||void 0===e?void 0:e.clientWidth)||0;t&&o&&n._zoom(1,t,o/2)}),Ne(n,"zoomOut",function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n._options.zoomSpeed,o=(null===(e=n._scrollContainer)||void 0===e?void 0:e.clientWidth)||0;t&&o&&n._zoom(-1,t,o/2)}),Ne(n,"_setZoom",function(e){var t,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r=f.isNumber(r)?r:null===(t=n._options)||void 0===t?void 0:t.zoomMin,i=f.isNumber(i)?i:null===(o=n._options)||void 0===o?void 0:o.zoomMax,f.isNumber(e)){e=(e=f.keepInBounds(e,r,i))||1;var l=new G;return l.val=e,l.prevVal=n._currentZoom,n.emit(Se.ZoomChanged,l),n._currentZoom=e,e}return e}),Ne(n,"setZoom",function(e){var t=n.getZoom();if(t!==e){var o=n._setZoom(e);if(t!=o){var r=n.valToPx(n._val),i=Math.round(r-n._canvasClientWidth()*e);return i<=0&&(i=0),n._rescaleInternal(i+n._canvasClientWidth(),null,we.ZoomMode),n.scrollLeft=i,n.redraw(),o}}return t}),Ne(n,"getZoom",function(){return f.isNumber(n._currentZoom)&&n._currentZoom||1}),Ne(n,"_getClickDetectionRadius",function(e){var t=n._consts.clickDetectionMinRadius||1;return Math.max(t,(null==e?void 0:e.radius)||t)}),Ne(n,"_handleContextMenu",function(e){if(f.clearBrowserSelection(),n._canvas&&n._scrollContainer){var o=n._trackMousePos(n._canvas,e),r=n._getClickDetectionRadius(o),i=n.elementFromPoint(o.pos,r,[]),l=n._findDraggableElement(i,o.val),a=new se;a.point=o,a.args=e,a.elements=i,a.target=l,console.log("_handleContextMenu",Se.ContextMenu),Oe(t,"emit",n,3)([Se.ContextMenu,a])}else n._cleanUpSelection()}),Ne(n,"_handleMouseDownEvent",function(e){if(f.clearBrowserSelection(),n._canvas&&n._scrollContainer){if(n._startPosMouseArgs=n._trackMousePos(n._canvas,e),n._startPosMouseArgs){var o=Date.now()-n._lastClickTime<n._consts.doubleClickTimeoutMs;n._lastClickPoint&&n._startPosMouseArgs&&f.getDistance(n._lastClickPoint.x,n._lastClickPoint.y,n._startPosMouseArgs.pos.x,n._startPosMouseArgs.pos.y)>n._consts.clickThreshold&&(o=!1),n._lastClickPoint=n._startPosMouseArgs.pos,n._scrollStartPos={x:n._scrollContainer.scrollLeft,y:n._scrollContainer.scrollTop},n._clickAllowed=!0;var r=null;n._interactionMode!==pe.NonInteractivePan&&n._interactionMode!==pe.None||(r=[w.Timeline,w.DurationLine]);var i=n._getClickDetectionRadius(n._startPosMouseArgs),l=n.elementFromPoint(n._startPosMouseArgs.pos,i,r),a=n._findDraggableElement(l,n._startPosMouseArgs.val),s=new se;if(s.point=n._startPosMouseArgs,s.args=e,s.elements=l,s.target=a,o)Oe(t,"emit",n,3)([Se.DoubleClick,s]);else if(Oe(t,"emit",n,3)([Se.MouseDown,s]),n._clickTimeout=Date.now(),n._lastClickTime=Date.now(),s.isPrevented())n._cleanUpSelection();else{var u;if(n._currentPos=n._startPosMouseArgs,a&&n._interactionMode!==pe.Zoom)if(n._drag=new T,n._drag.val=a.val,n._drag.type=a.type,n._drag.target=n._setElementDragState(a,a.val),a.type===w.Keyframe)n._startedDragWithCtrl=n._controlKeyPressed(e),n._startedDragWithShiftKey=e.shiftKey,null==a||!a.keyframe||null!=a&&null!==(u=a.keyframe)&&void 0!==u&&u.selected||n._controlKeyPressed(e)||n._selectInternal(a.keyframe),n._drag.elements=n.getSelectedElements().map(function(e){return n._setElementDragState(e,e.val)});else if(a.type===w.Group){var c=n._drag.target.keyframes;c&&Array.isArray(c)&&(n._drag.elements=c.map(function(e){var t;return n._setElementDragState(n._convertToTimelineElement((null===(t=n._drag)||void 0===t?void 0:t.target.row)||null,e),e.val)}))}else n._drag.elements=[n._drag.target];n.redraw()}}}else n._cleanUpSelection()}),Ne(n,"_setElementDragState",function(e,t){var n=e;return n.prevVal=n.val,void 0!==n.startedVal&&null!==n.startedVal||(n.startedVal=t),void 0!==n.prevVal&&null!==n.prevVal||(n.prevVal=t),n.val=t,n}),Ne(n,"isLeftButtonClicked",function(e){return!!e&&1==e.buttons}),Ne(n,"_handleMouseMoveEvent",function(e){if(e?n._lastUsedArgs=e:e=n._lastUsedArgs,e&&n._canvas){var t=e,o=t.changedTouches&&t.changedTouches.length>0;n._currentPos=n._trackMousePos(n._canvas,e),!n._isPanStarted&&n._selectionRect&&n._clickTimeoutIsOver()?n._interactionMode===pe.None||n._interactionMode===pe.Zoom||n._interactionMode===pe.NonInteractivePan?n._selectionRectEnabled=!1:n._selectionRectEnabled=!0:n._selectionRectEnabled=!1;var r=n.isLeftButtonClicked(e);if(r||(n._scrollAreaClickOrDragStarted=!1),n._startPosMouseArgs)if(r||o){if(n._drag&&!n._startedDragWithCtrl){var i=n._currentPos.val;if(n._drag.type===w.DurationLine)n._setDurationInternal(i,F.User);else if(n._drag.type===w.Timeline)n._setTimeInternal(i,F.User);else if((n._drag.type==w.Keyframe||n._drag.type==w.Group)&&n._drag.elements){var l=Math.floor(i-n._drag.val);if(0!==n._moveElements(l,n._drag.elements,F.User)){if(!n._drag.changed){n._drag.prevVal=n._drag.val;var a=n._emitDragStartedEvent(n._drag);if(!a||a.isPrevented())return n._cleanUpSelection(!0),void(n._drag=null)}n._drag.changed=!0,n._drag.val+=l,n._emitDragEvent(n._drag)}}}n._durationVal>0&&(n._currentPos.val<n._durationVal||null===n._options.max||void 0===n._options.max)&&(n._interactionMode!==pe.Pan&&n._interactionMode!==pe.NonInteractivePan||n._drag?n._interactionMode!==pe.None&&n._scrollBySelectionOutOfBounds(n._currentPos.pos):(n._isPanStarted=!0,n._setCursor(me.Grabbing),n._scrollByPan(n._startPosMouseArgs.pos,n._currentPos.pos,n._scrollStartPos))),n.redraw()}else n._cleanUpSelection(!0),n.redraw();else if(!o){var s=null;n._interactionMode!==pe.NonInteractivePan&&n._interactionMode!==pe.None||(s=[w.Timeline,w.DurationLine]);var u=n._getClickDetectionRadius(n._currentPos),c=n.elementFromPoint(n._currentPos.pos,u,s),d=n._findDraggableElement(c,n._currentPos.val);if(n._isPanStarted||n._interactionMode===pe.Pan||n._interactionMode===pe.NonInteractivePan)r?n._setCursor(me.Grabbing):n._setCursor(me.Grab);else{if(n._interactionMode===pe.Zoom)return void n._setZoomCursor(e);n._setCursor(me.Default)}if(d){var f=null;if(d.type===w.Group)f=f||me.EWResize;else if(d.type==w.Keyframe)f=f||me.Pointer;else if(d.type==w.Timeline||d.type===w.DurationLine){var v;f=f||(null===(v=n._options)||void 0===v||null===(v=v.timelineStyle)||void 0===v?void 0:v.cursor)||null}f&&n._setCursor(f)}}o&&e.preventDefault()}}),Ne(n,"_handleMouseUpEvent",function(e){if(n._scrollAreaClickOrDragStarted=!1,n._canvas&&n._startPosMouseArgs){var t=n._trackMousePos(n._canvas,e);if(n._clickAllowed||!n._clickTimeoutIsOver()||n._drag&&(n._startedDragWithCtrl||n._startedDragWithShiftKey))if(n._options&&n._interactionMode===pe.Zoom){var o=n._controlKeyPressed(e)?1:-1,r=n._getMousePos(n._canvas,e),i=Math.max(0,r.pos.x||0);n._zoom(o,n._options.zoomSpeed||0,i)}else n._performClick(t,n._drag);else if(!n._drag&&n._selectionRect&&n._selectionRectEnabled)if(n._interactionMode===pe.Zoom);else if(n._interactionMode!==pe.None){var l=n._getKeyframesByRectangle(n._selectionRect),a=e.shiftKey?be.Append:be.Normal;n.select(l,a)}n._cleanUpSelection(),n.redraw()}}),Ne(n,"_canvasClientHeight",function(){return n._canvas?n._canvas.clientHeight:0}),Ne(n,"_canvasClientWidth",function(){return n._canvas?n._canvas.clientWidth:0}),Ne(n,"_getKeyframesByRectangle",function(e){var t=[];return n._forEachKeyframe(function(n){(n.shape===l.Rect?f.isRectIntersects(n.size,e):f.isOverlap(n.size.x,n.size.y,e))&&t.push(n.model)}),t}),Ne(n,"_performClick",function(e,t){var o=!1;if(t&&t.type===w.Keyframe){var r,i,l=be.Normal;n._startedDragWithCtrl&&n._controlKeyPressed(e.args)?n._controlKeyPressed(e.args)&&(l=be.Revert):n._startedDragWithShiftKey&&e.args.shiftKey&&(l=be.Append),o=n._selectInternal((null==t||null===(r=t.target)||void 0===r?void 0:r.keyframe)||null,l).selectionChanged||o,e.args.shiftKey&&!1!==(null===(i=n._options)||void 0===i?void 0:i.timelineDraggable)&&(o=n._setTimeInternal(e.val,F.User)||o)}else{var a;if(o=n._selectInternal(null).selectionChanged||o,!1!==(null===(a=n._options)||void 0===a?void 0:a.timelineDraggable)){var s=S.headerHeight(n._options);e.pos.y<s&&(o=n._setTimeInternal(e.val,F.User)||o)}}return o}),Ne(n,"_setKeyframePos",function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.Programmatically;if(!e||!e.keyframe)return t;if(t=Math.floor(t),e.keyframe&&e.keyframe.val!=t){e.prevVal=e.val,e.val=t,e.keyframe.val=t;var r=n._emitKeyframeChanged(e,o);return r.isPrevented()&&(e.val=r.prevVal,e.keyframe.val=r.prevVal),t}return t}),Ne(n,"_setCursor",function(e){n._canvas&&n._canvas.style.cursor!=e&&(n._canvas.style.cursor=e)}),Ne(n,"setInteractionMode",function(e){n._interactionMode!=e&&(n._interactionMode=e,n._cleanUpSelection(!0),n.redraw())}),Ne(n,"getInteractionMode",function(){return n._interactionMode}),Ne(n,"_convertToTimelineElement",function(e,t){return{type:w.Keyframe,val:t.val,keyframe:t,row:e}}),Ne(n,"getSelectedKeyframes",function(){return n.getSelectedElements().map(function(e){return e.keyframe})}),Ne(n,"getSelectedElements",function(){var e=[];return n._forEachKeyframe(function(t){t&&t.model.selected&&e.push(n._convertToTimelineElement(t.rowViewModel.model,t.model))}),e}),Ne(n,"getAllKeyframes",function(){var e=[];return n._forEachKeyframe(function(t){e.push(t.model)}),e}),Ne(n,"selectAllKeyframes",function(){return n.select(n.getAllKeyframes(),be.Normal)}),Ne(n,"deselectAll",function(){return n.select(null)}),Ne(n,"_changeNodeState",function(e,t,n){if(t.selected!==n){var o="boolean"!=typeof t.selectable||t.selectable;if(!n||n&&o)return t.selected=n,e.changed.push(t),!0}return!1}),Ne(n,"select",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be.Normal,o=n._selectInternal(e,t);return o.selectionChanged&&n.redraw(),o}),Ne(n,"_selectInternal",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be.Normal;e||(e=[]),Array.isArray(e)||(e=[e]);var o={selectionChanged:!1,selected:n.getSelectedKeyframes(),changed:[]},r=e;if(r&&t===be.Append)e.forEach(function(e){n._changeNodeState(o,e,!0)&&e.selected&&o.selected.push(e)});else if(r&&t===be.Revert)e.forEach(function(e){o.selected.indexOf(e)>=0?(n._changeNodeState(o,e,!1),f.deleteElement(o.selected,e)):(n._changeNodeState(o,e,!0),e.selected&&o.selected.push(e))});else if(t===be.Normal){var i=[];e&&e.forEach(function(e){n._changeNodeState(o,e,!0),e.selected&&i.push(e)}),o.selected.forEach(function(e){r.indexOf(e)>=0||n._changeNodeState(o,e,!1)}),o.changed.length>0&&(i?o.selected=i:o.selected.length=0)}return o.changed.length>0&&(o.selectionChanged=!0,n._emitKeyframesSelected(o)),o}),Ne(n,"_startAutoPan",function(){n._consts.autoPanSpeed&&(n._intervalRef||(n._intervalRef=window.setInterval(function(){n._handleMouseMoveEvent(null)},n._consts.autoPanSpeed)))}),Ne(n,"_stopAutoPan",function(){n._intervalRef&&(clearInterval(n._intervalRef),n._intervalRef=null),n._autoPanLastActionDate=0}),Ne(n,"_toScreenPx",function(e){return n.valToPx(e)-n.scrollLeft+n._leftMargin()}),Ne(n,"_fromScreen",function(e){return n.pxToVal(n.scrollLeft+e-n._leftMargin())}),Ne(n,"valToPx",function(e){if(!n._options||!n._options.stepPx)return e;var t=n._options.min||0;f.isNumber(t)||(t=0),t*=n._currentZoom||1;var o=(n._options.stepVal||0)*n._currentZoom||1;return(-t+e)*(n._options.stepPx/o)}),Ne(n,"_mousePosToVal",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=Math.min(e,n._canvasClientWidth()),r=n._fromScreen(o);return r=Math.round(r),t&&(r=n.snapVal(r)),r}),Ne(n,"_formatUnitsText",function(e){var t=f.sign(e)<0?"-":"";e=Math.abs(e);var n=Math.floor(e/1e3),o=Math.floor(n/3600),r=Math.floor(n%3600/60),i=(n%60).toString().padStart(2,"0");return t+(o>0?o+":"+r.toString().padStart(2,"0")+":"+i:r+":"+i)}),Ne(n,"_leftMargin",function(){var e;return(null===(e=n._options)||void 0===e?void 0:e.leftMargin)||0}),Ne(n,"_renderTicks",function(){var e;if(!(!n._ctx||!n._ctx.canvas||n._ctx.canvas.clientWidth<=0||n._ctx.canvas.clientHeight<=0)&&n._options&&n._options.stepPx){var t=n._canvasClientWidth()-n._leftMargin(),o=n.pxToVal(n.scrollLeft),r=n.pxToVal(n.scrollLeft+t);if(!isNaN(o)&&!isNaN(r)&&o!==r){if(r<o){var i=r;r=o,o=i}var l=f.getDistance(o,r);if(!(l<=0)){var a=f.findGoodStep(l/(t/n._options.stepPx),0,null===(e=n._options)||void 0===e?void 0:e.denominators),s=Math.floor(o/a)*a,u=Math.ceil(r/a)*a+a;if(f.isNumber(a)&&!(a<=0)&&0!==Math.abs(u-s)){var c=0;n._ctx.save();for(var d=S.headerHeight(n._options),v=d/2,_=d/1.7,y=s;y<=u;y+=a){var h=n._getSharp(n._toScreenPx(y)),p=y%1e3==0;n._ctx.save(),n._ctx.beginPath(),n._ctx.setLineDash(p?[4]:[]),n._ctx.lineWidth=1,n._options.tickColor&&(n._ctx.strokeStyle=n._options.tickColor);var m=p?v:_;if(f.drawLine(n._ctx,h,m,h,d),n._ctx.stroke(),p){n._options.labelsColor&&(n._ctx.fillStyle=n._options.labelsColor),n._options.font&&(n._ctx.font=n._options.font);var g=n._formatUnitsText(y),b=n._ctx.measureText(g),w=h-b.width/2;(isNaN(c)||c<=w)&&(c=w+b.width,n._ctx.fillText(g,w,10))}n._ctx.restore()}n._ctx.restore()}}}}}),Ne(n,"_generateViewModel",function(){var e={size:{x:0,y:0,width:0,height:0},min:null,max:null,rowsViewModels:[],keyframesViewModels:[]};if(!n._model)return e;var t=n._model.rows;if(!t||!Array.isArray(t)||t.length<=0)return e;var o=S.headerHeight(n._options);return t.forEach(function(t,r){if(t&&!t.hidden){var i=S.getRowHeight(t.style||null,n._options),l=S.getRowMarginBottom(t.style||null,n._options),a=o-(n._scrollContainer?n._scrollContainer.scrollTop:0);o+=i+l,0==r&&(o+=l,a+=l,e.size.y=a+l),e.size.height=Math.max(o+i,e.size.height);var s={size:{x:0,y:a,width:n._canvasClientWidth(),height:i},marginBottom:l,model:t,index:r,min:null,max:null,groupsViewModels:[],keyframesViewModels:[]};e.rowsViewModels.push(s),!t.keyframes||!t.keyframes.forEach||t.keyframes.length<=0||(t&&t.keyframes&&t.keyframes.forEach(function(o){var r;if(o&&f.isNumber(o.val)){if(!o.hidden){var i=(null===(r=s.groupsViewModels)||void 0===r?void 0:r.find(function(e){return o.group===e.groupModel}))||null;i||(i={min:o.val,max:o.val,size:null,groupModel:o.group,keyframesViewModels:[]},s.groupsViewModels.push(i));var l=S.keyframeShape(o,o.group,t.style||null,n._options),a=n._getKeyframePosition(o,i,s,l),u={model:o,rowViewModel:s,groupViewModel:i,size:a,shape:l},c=null===i.min?o.val:Math.min(o.val,i.min),d=null===i.max?o.val:Math.max(o.val,i.max);f.isNumber(c)&&(i.min=c),f.isNumber(d)&&(i.max=d),s.keyframesViewModels.push(u),i.keyframesViewModels.push(u),e.keyframesViewModels.push(u)}}else console.log("Unexpected null keyframe or having invalid value")}),s.groupsViewModels.forEach(function(e){f.setMinMax(s,e,!0);var t=n._getKeyframesGroupSize(e,s);e.size=t}),f.setMinMax(e,s,!0))}}),f.isNumber(e.max)&&(e.max||0===e.max)&&(e.size.width=n.valToPx(e.max)),e}),Ne(n,"_renderRows",function(){if(n._ctx){var e=n._generateViewModel();if(null!=e&&e.rowsViewModels)try{n._ctx.save(),e.rowsViewModels.forEach(function(e){var t;if(e&&n._ctx){n._ctx.fillStyle=S.getRowFillColor(e.model.style||null,n._options);var o=n._cutBounds(e.size);if(null!=o&&o.rect){var r=null==o?void 0:o.rect;n._ctx.fillRect(r.x,r.y,r.width,r.height)}if(n._renderGroupBounds(e),null!=o&&o.rect&&null!==(t=e.model.keyframes)&&void 0!==t&&null!==(t=t[0].metadata.frames)&&void 0!==t&&t[0]){var i,l,a,s,u,c,d,f,v,_,y,h,p=null==o?void 0:o.rect,m=n.valToPx(null!==(i=null===(l=e.model.keyframes[0])||void 0===l?void 0:l.val)&&void 0!==i?i:0)-n.scrollLeft,g=n.valToPx(null!==(a=null===(s=e.model.keyframes[1])||void 0===s?void 0:s.val)&&void 0!==a?a:0)-n.scrollLeft,b=n.valToPx(null!==(u=n._durationVal)&&void 0!==u?u:0),w=null===(c=e.model.keyframes)||void 0===c?void 0:c[0].metadata.frameWidth,k=null!==(d=null===(f=e.model.keyframes)||void 0===f?void 0:f[0].metadata.scaleFactor)&&void 0!==d?d:1;if(!isNaN(w)&&w>0){var C=e.model.keyframes[0].metadata.frames.length,x=Math.floor(b/w),M=0;C<x&&(M=(x-C)*w/(C-1));for(var P=0;P<Math.min(x+1,C);P++){var T,E=(w+M)*P,D=Math.floor(E/b*C),O=e.model.keyframes[0].metadata.frames[D],R=p.x+(null!==(T=n._options.leftMargin)&&void 0!==T?T:0)+E-n.scrollLeft;if(R>=0&&O)if(R+w<=b)n._ctx.drawImage(O,R,p.y,w,p.height);else{var j=b-R+n._leftMargin();n._ctx.drawImage(O,0,0,j/k,p.height/k,R,p.y,j,p.height)}}}var N,z,V=null!==(v=null!==(_=null===(y=e.model.style)||void 0===y?void 0:y.fillColor)&&void 0!==_?_:null===(h=n._options.rowsStyle)||void 0===h?void 0:h.fillColor)&&void 0!==v?v:"#FFFFFF";V.startsWith("#")&&9===V.length&&(n._ctx.fillStyle=V.substring(0,7)+"BF"),m>0&&n._ctx.fillRect(p.x+(null!==(N=n._options.leftMargin)&&void 0!==N?N:0),p.y,m,p.height),g<b&&n._ctx.fillRect(p.x+(null!==(z=n._options.leftMargin)&&void 0!==z?z:0)+g,p.y,b-g,p.height)}}})}finally{n._ctx.restore()}}}),Ne(n,"_renderGroupBounds",function(e){var t;e&&n._ctx&&(null==e||null===(t=e.groupsViewModels)||void 0===t||t.forEach(function(t){var o,r,i,l,a;if(n._ctx&&!(((null==t||null===(o=t.keyframesViewModels)||void 0===o?void 0:o.length)||0)<=1)){var s=S.groupFillColor(n._options,t.groupModel,null==e||null===(r=e.model)||void 0===r?void 0:r.style),u=S.groupStrokeColor(n._options,t.groupModel,null==e||null===(i=e.model)||void 0===i?void 0:i.style),c=S.groupStrokeThickness(n._options,t.groupModel,null==e||null===(l=e.model)||void 0===l?void 0:l.style),d=S.groupsRadii(n._options,t.groupModel,null==e||null===(a=e.model)||void 0===a?void 0:a.style);if(t.size)try{n._ctx.save();var f=n._cutBounds(t.size);if(null!=f&&f.rect){var v=f.rect;u||(c=0),n._ctx.strokeStyle=c>0?u:"",n._ctx.fillStyle=s,n._ctx.lineWidth=c,n._ctx.beginPath(),n._ctx.roundRect(v.x+c,v.y+c,v.width-c,v.height-c,d),n._ctx.fill(),c>0&&n._ctx.stroke()}}finally{n._ctx.restore()}else console.log("Size of the group cannot be calculated")}}))}),Ne(n,"_cutBounds",function(e){if(!e)return null;var t=n._canvasClientWidth()-0,o=S.headerHeight(n._options)+0,r=n._canvasClientHeight()-0;return n._cutBoundsWhenOverlap(e,0,t,o,r)}),Ne(n,"_cutBoundsWhenOverlap",function(e,t,n,o,r){if(!e)return null;if(f.isRectIntersects(e,{x:t,y:o,width:f.getDistance(t,n),height:f.getDistance(o,r)})){var i=Math.max(e.y,o),l=Math.max(e.x,t),a=e.x-l,s=e.y-i;return{rect:{height:e.height+s,width:e.width+a,x:l,y:i},overlapY:Math.abs(s)>0,overlapX:Math.abs(a)>0}}return null}),Ne(n,"_getKeyframesGroupSize",function(e,t){var o,r,i=t.size.y,l=t.size.height,a=e.groupModel||null,s=S.groupHeight(n._options,a,null==t||null===(o=t.model)||void 0===o?void 0:o.style),u=S.groupMarginTop(n._options,a,null==t||null===(r=t.model)||void 0===r?void 0:r.style),c="auto"===s;s&&!c||(s=Math.floor(l)),(s="string"==typeof s?parseInt(s):s)>l&&(s=l);var d="auto"===u;"string"==typeof u&&(u=d?(l-s)/2:parseInt(u)||0),d||c&&(s-=2*u);var v=n._toScreenPx(e.min),_=n._toScreenPx(e.max);return{x:v,y:i+u,height:s,width:f.getDistance(v,_)}}),Ne(n,"_getKeyframePosition",function(e,t,o,r){var i,a;if(!e)return console.log("keyframe should be defined."),null;var s=e.val;if(!f.isNumber(s))return null;var u=o.size,c=u.y+u.height/2,d=(null==t?void 0:t.groupModel)||null,v=S.keyframeHeight(e,d,null==o||null===(i=o.model)||void 0===i?void 0:i.style,n._options),_=S.keyframeWidth(e,d,null==o||null===(a=o.model)||void 0===a?void 0:a.style,n._options);if("auto"===v&&(v=u.height/3),"auto"===_&&(_=v),v=Number(v),!Number.isNaN(v)&&v&&v>0){var y={x:Math.floor(n._toScreenPx(s)),y:c=Math.floor(c),height:v,width:_};return r===l.Rect&&(y.y=y.y-y.height/2,y.x=y.x-y.width/2),y}return null}),Ne(n,"_renderKeyframes",function(){n._forEachKeyframe(function(e){if(n._ctx){var t=e.size;if(t){var o=n._getSharp(t.x),r=t.y,i=n._cutBounds({x:o-t.width/2,y:r-t.height/2,width:t.width,height:t.height});if(!i)return;n._ctx.save();try{i&&i.overlapY&&(n._ctx.beginPath(),n._ctx.rect(0,S.headerHeight(n._options),n._canvasClientWidth(),n._canvasClientWidth()),n._ctx.clip()),n._renderKeyframe(n._ctx,e)}finally{n._ctx.restore()}}}})}),Ne(n,"_renderKeyframe",function(e,t){var o,r=t.shape;if(r!==l.None){var i=t.size,a=n._getSharp(i.x),s=i.y,u=t.model,c=t.rowViewModel.model.style||null,d=(null==t||null===(o=t.groupViewModel)||void 0===o?void 0:o.groupModel)||null,f=u.selected?S.keyframeSelectedFillColor(u,d,c,n._options):S.keyframeFillColor(u,d,c,n._options),v=S.keyframeStrokeThickness(u,d,c,n._options),_="";v>0&&(_=u.selected?S.keyframeSelectedStrokeColor(u,d,c,n._options):S.keyframeStrokeColor(u,d,c,n._options)),r==l.Rhomb?(e.beginPath(),e.translate(a,s),e.rotate(45*Math.PI/180),v>0&&_&&(e.fillStyle=_,e.rect(-i.width/2,-i.height/2,i.width,i.height),e.fill()),e.fillStyle=f,e.translate(v,v),e.rect(-i.width/2,-i.height/2,i.width-2*v,i.height-2*v),e.fill()):r==l.Circle?(e.beginPath(),v>0&&_&&(e.fillStyle=_,e.arc(a,s,i.height,0,2*Math.PI)),e.fillStyle=f,e.arc(a,s,i.height-v,0,2*Math.PI),e.fill()):r==l.Rect&&(e.beginPath(),v>0&&_&&(e.fillStyle=_,e.roundRect(a,s,i.width,i.height,2),e.fill()),e.fillStyle=f,e.roundRect(a+v,s+v,i.width-v,i.height-v,2),e.fill())}}),Ne(n,"_renderSelectionRect",function(){if(!n._drag&&n._ctx&&n._canvas){if(n._ctx.save(),n._selectionRect&&n._selectionRectEnabled){n._ctx.setLineDash([4]),n._ctx.lineWidth=n._pixelRatio;var e=n._options.selectionColor;e&&(n._ctx.strokeStyle=e),n._ctx.strokeRect(n._getSharp(n._selectionRect.x,1),n._getSharp(n._selectionRect.y,1),Math.floor(n._selectionRect.width),Math.floor(n._selectionRect.height))}n._ctx.restore()}}),Ne(n,"_renderBackground",function(){n._ctx&&n._canvas&&(n._options.fillColor?(n._ctx.save(),n._ctx.beginPath(),n._ctx.rect(0,0,n._canvasClientWidth(),n._canvasClientHeight()),n._ctx.fillStyle=n._options.fillColor,n._ctx.fill(),n._ctx.restore()):n._ctx.clearRect(0,0,n._canvas.width,n._canvas.height))}),Ne(n,"_renderTimeline",function(){if(null!==n&&n._ctx&&n._options&&n._options.timelineStyle){var e=n._options.timelineStyle;n._ctx.save();try{var t,o,r=e.width||1;n._ctx.lineWidth=r*n._pixelRatio;var i=n._getSharp(n._toScreenPx(n._val),r),l=n._getSharp(n._toScreenPx(n._durationVal),r);e.strokeColor&&(n._ctx.strokeStyle=e.strokeColor),e.fillColor&&(n._ctx.fillStyle=e.fillColor);var a=e.marginTop||0,s=e.marginBottom||0;n._ctx.beginPath();var u=n._canvasClientHeight()-s;f.drawLine(n._ctx,i,a,i,u),n._ctx.stroke(),n._ctx.beginPath(),e.durationStrokeColor&&(n._ctx.strokeStyle=e.durationStrokeColor),(e.durationCapStyle||e.durationStrokeColor)&&f.drawLine(n._ctx,l,0,l,u),n._ctx.stroke(),n._renderTimelineCap(i,a,null===(t=n._options)||void 0===t||null===(t=t.timelineStyle)||void 0===t?void 0:t.capStyle),n._renderTimelineCap(l,0,null===(o=n._options)||void 0===o||null===(o=o.timelineStyle)||void 0===o?void 0:o.durationCapStyle),n._ctx.beginPath(),n._ctx.rect(l,0,n._canvasClientWidth()-l,n._canvasClientHeight()),n._ctx.fillStyle="rgba(255, 255, 255, 0.3)",n._ctx.fill(),n._options.headerHeight&&(n._ctx.beginPath(),n._ctx.strokeStyle="#F2F4F7",n._ctx.moveTo(0,n._options.headerHeight),n._ctx.lineTo(n._canvasClientWidth(),n._options.headerHeight),n._ctx.stroke())}finally{n._ctx.restore()}}}),Ne(n,"_renderTimelineCap",function(e,t,o){if(n._ctx&&o&&o.capType!==ge.None){var r=o.width||0,i=o.height||0;r&&i&&(n._ctx.fillStyle=o.fillColor||"white",o.capType===ge.Triangle?(n._ctx.beginPath(),n._ctx.moveTo(e-r/2,t),n._ctx.lineTo(e+r/2,t),n._ctx.lineTo(e+r/2,t+i/2),n._ctx.lineTo(e,t+i),n._ctx.lineTo(e-r/2,t+i/2),n._ctx.closePath(),n._ctx.fill()):o.capType===ge.Rect&&n._ctx.fillRect(e-r/2,t,r,i))}}),Ne(n,"_renderHeaderBackground",function(){n._ctx&&n._options&&S.headerHeight(n._options)&&(n._ctx.save(),n._ctx.lineWidth=n._pixelRatio,n._options.headerFillColor?(n._ctx.lineWidth=n._pixelRatio,n._ctx.fillStyle=n._options.headerFillColor,n._ctx.fillRect(0,0,n._canvasClientWidth(),S.headerHeight(n._options))):n._ctx.clearRect(0,0,n._canvasClientWidth(),S.headerHeight(n._options)),n._ctx.restore())}),Ne(n,"redraw",function(){var e;null!==(e=window)&&void 0!==e&&e.requestAnimationFrame?window.requestAnimationFrame(n._redrawInternal):n._redrawInternal()}),Ne(n,"scrollToRightBounds",function(){n._scrollContainer&&n._scrollContainer.scrollLeft!==n._scrollContainer.scrollWidth&&(n.scrollLeft=n._scrollContainer.scrollWidth)}),Ne(n,"_redrawInternal",function(){var e;if(n._ctx&&n._scrollContainer){n.valToPx(n._val)>n._scrollContainer.scrollWidth&&(n.rescale(),!n._isPanStarted&&n._drag&&n._drag.type!==w.Timeline&&n._drag.type!==w.DurationLine&&n.scrollToRightBounds());var t=null!==(e=n._options.fillColor)&&void 0!==e?e:"#FFFFFF";if(t.startsWith("#")&&9===t.length&&!t.endsWith("FF")){var o,r=(null===(o=n._options.timelineStyle)||void 0===o?void 0:o.marginBottom)||0;n._ctx.clearRect(0,S.headerHeight(n._options),n._canvasClientWidth(),n._canvasClientHeight()-r-S.headerHeight(n._options))}n._renderBackground(),n._renderRows(),n._renderHeaderBackground(),n._renderTicks(),n._renderKeyframes(),n._renderSelectionRect(),n._renderTimeline()}else console.log("Context is not initialized")}),Ne(n,"_getSharp",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e=Math.round(e),t%2==0?e:e+n._pixelRatio/2}),Ne(n,"getTime",function(){return n._val}),Ne(n,"getDuration",function(){return n._durationVal}),Ne(n,"_setDurationInternal",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.Programmatically;if(!n._options)return!1;if(e=Math.round(e),e=f.keepInBounds(e,n._options.min),n._durationVal!=e){var o=n._durationVal,r=new G;return r.val=e,r.prevVal=o,r.source=t,n._durationVal=e,n.emit(Se.DurationChanged,r),!r.isPrevented()||(n._durationVal=o,!1)}return!1}),Ne(n,"_setTimeInternal",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.Programmatically;if(!n._options)return!1;if(e=Math.round(e),e=f.keepInBounds(e,n._options.min),n._val!=e){var o=n._val,r=new G;return r.val=e,r.prevVal=o,r.source=t,n._val=e,n.emit(Se.TimeChanged,r),!r.isPrevented()||(n._val=o,!1)}return!1}),Ne(n,"setDuration",function(e,t){if(n._drag&&n._drag.type===w.Timeline&&!0!==t)return!1;if(n._drag&&n._drag.type===w.DurationLine&&!0!==t)return!1;var o=n._setDurationInternal(e,F.SetTimeMethod);return o&&(n.rescale(),n.redraw()),o}),Ne(n,"setTime",function(e){if(n._drag&&n._drag.type===w.Timeline)return!1;if(n._drag&&n._drag.type===w.DurationLine)return!1;n.scrollLeft+n._canvasClientWidth()<n.valToPx(e)&&(n.scrollLeft=n.valToPx(e)-n._canvasClientWidth()+30);var t=n._setTimeInternal(e,F.SetTimeMethod);return t&&(n.rescale(),n.redraw()),t}),Ne(n,"getOptions",function(){return n._options}),Ne(n,"setOptions",function(e){return n._options=n._setOptions(e),n.rescale(),n.redraw(),n._options}),Ne(n,"_applyContainersStyles",function(){if(n._scrollContainer&&n._options){var e=n._scrollContainer.classList;n._options.scrollContainerClass&&!e.contains(n._options.scrollContainerClass)&&e.add(n._options.scrollContainerClass),n._options.fillColor&&(n._scrollContainer.style.background=n._options.fillColor)}}),Ne(n,"_setOptions",function(e){return e?(n._options=f.mergeOptions(n._options,e),n._options.snapStep=f.keepInBounds(n._options.snapStep||0,0,n._options.stepVal||0),n._currentZoom=n._setZoom(n._options.zoom||0,n._options.zoomMin,n._options.zoomMax),n._options.min=f.isNumber(n._options.min)?n._options.min:0,n._options.max=f.isNumber(n._options.max)?n._options.max:Number.MAX_VALUE,n._applyContainersStyles(),!1===e.timelineDraggable&&(n._drag&&n._drag.type===w.Timeline&&n._cleanUpSelection(),n._drag&&n._drag.type===w.DurationLine&&n._cleanUpSelection()),n._options):n._options||{}}),Ne(n,"getModel",function(){return n._model}),Ne(n,"setModel",function(e){n._model=e,n.rescale(),n.redraw()}),Ne(n,"_getMousePos",function(e,t){var n=1,o=0,r=0;if(t.changedTouches&&t.changedTouches.length>0){var i=t.changedTouches[0];o=i.clientX,r=i.clientY,n=Math.max(n,i.radiusX,i.radiusY)}else o=t.clientX,r=t.clientY;var l=window.devicePixelRatio||1,a=e.getBoundingClientRect(),s=e.width/l/a.width,u=e.height/l/a.height;return{pos:{x:(o-a.left)*s,y:(r-a.top)*u},radius:n,args:t}}),Ne(n,"_updateCanvasScale",function(){if(!(n._scrollContainer&&n._container&&n._ctx&&n._canvas))return console.log("Component should be initialized first."),!1;var e=!1,t=window.devicePixelRatio||1,o=n._scrollContainer.clientWidth,r=n._scrollContainer.clientHeight,i=o*t,l=r*t;return Math.floor(i)!=Math.floor(n._ctx.canvas.width)&&(n._ctx.canvas.width=i,e=!0),Math.floor(l)!=Math.floor(n._ctx.canvas.height)&&(n._ctx.canvas.height=l,e=!0),e&&(n._ctx.scale(t,t),n._canvas.style.width=o+"px",n._canvas.style.height=r+"px"),e}),Ne(n,"rescale",function(){return n._rescaleInternal()}),Ne(n,"_rescaleInternal",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:we.DefaultMode,r=n._updateCanvasScale();if(!n._scrollContent)return r;var i=n._generateViewModel();if(i&&i.size){var l,a=n._options.stepPx||0;e=e||0;var s=n.valToPx(n._val)+n._leftMargin(),u=0,c=n.valToPx(n._durationVal+1e3),d=n.scrollLeft+n.getClientWidth();s>=d&&(u=o==we.ScrollBySelection?Math.floor(s+n._leftMargin()):Math.floor(s+n.getClientWidth()+n._leftMargin()));var f=i.size.width+n._leftMargin()+a;e=Math.max(e,f,d,u,c);var v=Math.floor(e)+"px";v!=n._scrollContent.style.minWidth&&(n._scrollContent.style.minWidth=v,r=!0),t=Math.max(Math.floor(i.size.height+.2*n._canvasClientHeight()),((null===(l=n._scrollContainer)||void 0===l?void 0:l.scrollTop)||0)+n._canvasClientHeight()-1,Math.round(t||0));var _=Math.floor(t)+"px";if(n._scrollContent.style.minHeight!=_)return n._scrollContent.style.minHeight=_,r}return r}),Ne(n,"_filterDraggableElements",function(e){return e.filter(function(e){if(!e)return!1;var t;if(e.type===w.Keyframe){if(!S.keyframeDraggable(e.keyframe||null,(null===(t=e.keyframe)||void 0===t?void 0:t.group)||null,(null==e?void 0:e.row)||null,n._options))return!1}else if(e.type===w.Group){if(!S.groupDraggable(e.group||null,e.row||null,n._options))return!1}else if(e.type===w.Timeline){var o;if(!1===(null===(o=n._options)||void 0===o?void 0:o.timelineDraggable))return!1}else if(e.type===w.Row)return!1;return!0})}),Ne(n,"_findDraggableElement",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=function(e){return e===w.Timeline?4:e===w.Keyframe?1:e===w.Group?2:e===w.DurationLine&&n._isDurationLinePresent()?3:-1},r=n._filterDraggableElements(e).sort(function(e,n){var r=o(e.type),i=o(n.type);return r!==i||null!==t&&(r=f.getDistance(e.val,t))!==(i=f.getDistance(n.val,t))?r<i?1:-1:0});return r.length>0?r[r.length-1]:null}),Ne(n,"elementFromPoint",function(e,t,o){var r;t=Math.max(t,1);var i=[];if(!e)return i;var a,s=S.headerHeight(n._options),u=n._toScreenPx(n._val),c=n._toScreenPx(n._durationVal),d=0,v=null===(r=n._options)||void 0===r?void 0:r.timelineStyle;v&&(d=Math.max((v.width||1)*n._pixelRatio,((null==v||null===(a=v.capStyle)||void 0===a?void 0:a.width)||0)*n._pixelRatio||1)+t),(e.y<=.5*s||e.x>=u-d/2&&e.x<=u+d/2)&&i.push({val:n._val,type:w.Timeline}),e.x>=c-d/2&&e.x<=c+d/2&&n._isDurationLinePresent()&&i.push({val:n._durationVal,type:w.DurationLine});var _=n._options.snapEnabled;return e.y>=s&&n._options.keyframesDraggable&&n._forEachKeyframe(function(o,r,a){var s=o.rowViewModel;a&&s.groupsViewModels&&s.groupsViewModels.forEach(function(t){if(null!=t&&t.size&&f.isOverlap(e.x,e.y,t.size)){var o=(null==t?void 0:t.keyframesViewModels.map(function(e){return e.model}))||[],r={val:n._mousePosToVal(e.x,_),type:w.Group,group:t.groupModel,row:s.model,keyframes:o},l=n.snapVal(t.min);r.val+=t.min-l,i.push(r)}});var u=o.size;if(u){var c=!1;if(o.shape===l.Rect){var d=f.shrinkSelf({x:e.x,y:e.y,height:t,width:t},t);c=f.isRectIntersects(d,u,!0)}else c=f.getDistance(u.x,u.y,e.x,e.y)<=u.height+t;c&&i.push({keyframe:o.model,keyframes:[o.model],val:o.model.val,row:o.rowViewModel.model,type:w.Keyframe})}},function(t){if(f.isOverlap(e.x,e.y,t.size)){var o={val:n._mousePosToVal(e.x,_),keyframes:t.model.keyframes,type:w.Row,row:t.model};i.push(o)}}),o&&0!==o.length?i.filter(function(e){return o&&o.includes(e.type)}):i}),Ne(n,"onDurationChanged",function(e){n.on(Se.DurationChanged,e)}),Ne(n,"onTimeChanged",function(e){n.on(Se.TimeChanged,e)}),Ne(n,"onDragStarted",function(e){n.on(Se.DragStarted,e)}),Ne(n,"onZoom",function(e){n.on(Se.ZoomChanged,e)}),Ne(n,"onDrag",function(e){n.on(Se.Drag,e)}),Ne(n,"onDragFinished",function(e){n.on(Se.DragFinished,e)}),Ne(n,"onDoubleClick",function(e){n.on(Se.DoubleClick,e)}),Ne(n,"onKeyframeChanged",function(e){n.on(Se.KeyframeChanged,e)}),Ne(n,"onMouseDown",function(e){n.on(Se.MouseDown,e)}),Ne(n,"onSelected",function(e){n.on(Se.Selected,e)}),Ne(n,"onScroll",function(e){n.on(Se.Scroll,e)}),Ne(n,"onScrollFinished",function(e){n.on(Se.ScrollFinished,e)}),Ne(n,"onContextMenu",function(e){n.on(Se.ContextMenu,e)}),Ne(n,"onKeyDown",function(e){n.on(Se.KeyDown,e)}),Ne(n,"onKeyUp",function(e){n.on(Se.KeyUp,e)}),Ne(n,"onKeyPress",function(e){n.on(Se.KeyPress,e)}),Ne(n,"_emitScrollEvent",function(e,o){var r,i,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Se.Scroll,a={args:e,scrollProgrammatically:o,scrollLeft:n.scrollLeft,scrollTop:n.scrollTop,scrollHeight:(null===(r=n._scrollContainer)||void 0===r?void 0:r.scrollHeight)||0,scrollWidth:(null===(i=n._scrollContainer)||void 0===i?void 0:i.scrollWidth)||0};return Oe(t,"emit",n,3)([l,a]),a}),Ne(n,"_emitKeyframeChanged",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.Programmatically,o=new K;return o.val=e.val,o.prevVal=e.prevVal,o.target=e,o.source=t,n.emit(Se.KeyframeChanged,o),o}),Ne(n,"_emitDragStartedEvent",function(e){if(!e)return null;var t=n._getDragEventArgs(e,n._currentPos);return n.emit(Se.DragStarted,t),t.isPrevented()&&n._preventDrag(t,e,!0),t}),Ne(n,"_emitDragFinishedEvent",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||!e.changed)return null;var o=n._getDragEventArgs(e,n._currentPos);return t&&o.preventDefault(),n.emit(Se.DragFinished,o),o.isPrevented()&&n._preventDrag(o,e,!0),o}),Ne(n,"_preventDrag",function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.elements&&e.elements.forEach(function(e){var t=o?e.startedVal:e.prevVal;n._setKeyframePos(e,t)}),t.val=t.prevVal,e.point=e.prevPoint}),Ne(n,"_emitDragEvent",function(e){if(!e)return null;var t=n._getDragEventArgs(e,n._currentPos);return n.emit(Se.Drag,t),t.isPrevented()&&n._preventDrag(t,e,!1),t}),Ne(n,"_emitKeyframesSelected",function(e){var t=new ee;return t.selected=e.selected,t.changed=e.changed,n.emit(Se.Selected,t),t}),Ne(n,"_getDragEventArgs",function(e,t){var n=new he;return n.point=t,n.elements=function(e){return function(e){if(Array.isArray(e))return Pe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Pe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.elements||[]),n.target=(null==e?void 0:e.target)||null,n}),n._options=f.cloneOptions(xe),n._durationVal=null!==(e=null==o?void 0:o.totalDuration)&&void 0!==e?e:0,(o||r)&&n.initialize(o,r),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&De(e,t)}(t,e),n=t,o=[{key:"_getCtx",value:function(){return this._canvas?(this._ctx||(this._ctx=this._canvas.getContext("2d")),this._ctx):null}},{key:"_moveElements",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.Programmatically;if(!t)return 0;var r=!1;if(Math.abs(e)>0){var i={min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER};if(i=f.setMinMax(i,this._options),t.forEach(function(t){var o;if(t&&t.keyframe){var r=f.setMinMax(f.setMinMax({min:i.min,max:i.max},t.keyframe),t.row||null),l=(null!==(o=n._options)&&void 0!==o&&o.snapAllKeyframesOnMove?n.snapVal(t.keyframe.val):t.keyframe.val)+e;(r.min||0===r.min)&&f.isNumber(r.min)&&l<r.min&&(e+=f.getDistance(r.min,l)),(r.max||0===r.max)&&f.isNumber(r.max)&&l>r.max&&(e-=f.getDistance(r.max,l))}}),Math.abs(e)>0&&t.forEach(function(t){if(null!=t&&t.keyframe){var i=t.keyframe.val,l=i+e,a=n._setKeyframePos(t,l,o);r=a!==i}}),r)return e}return 0}},{key:"_forEachKeyframe",value:function(e,t){var n;if((e||t)&&this._model){var o=this._generateViewModel();o&&(null==o||null===(n=o.rowsViewModels)||void 0===n||n.forEach(function(n){if(n){t&&t(n);var o=!0;e&&n.keyframesViewModels.forEach(function(t,n){t&&e(t,n,o),o=!1})}}))}}},{key:"_trackMousePos",value:function(e,t){var n=this._getMousePos(e,t),o=n.pos;if(n.originalVal=this._mousePosToVal(o.x,!1),n.snapVal=this._mousePosToVal(o.x,!0),n.val=n.originalVal,this._options&&this._options.snapEnabled&&(n.val=n.snapVal),this._startPosMouseArgs){var r,i;this._selectionRect||(this._selectionRect={});var l=this._startPosMouseArgs.pos,a=Math.floor(l.x+(((null===(r=this._scrollStartPos)||void 0===r?void 0:r.x)||0)-this.scrollLeft)),s=Math.floor(l.y+(((null===(i=this._scrollStartPos)||void 0===i?void 0:i.y)||0)-this.scrollTop));this._selectionRect.x=Math.min(a,o.x),this._selectionRect.y=Math.min(s,o.y),this._selectionRect.width=Math.max(a,o.x)-this._selectionRect.x,this._selectionRect.height=Math.max(s,o.y)-this._selectionRect.y,this._clickAllowed&&(this._clickAllowed=this._selectionRect.height<=this._consts.clickThreshold&&this._selectionRect.width<=this._consts.clickThreshold)}return n}},{key:"getClientWidth",value:function(){var e;return(null===(e=this._scrollContainer)||void 0===e?void 0:e.clientWidth)||0}},{key:"getClientHeight",value:function(){var e;return(null===(e=this._scrollContainer)||void 0===e?void 0:e.clientHeight)||0}},{key:"_cleanUpSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._drag&&this._emitDragFinishedEvent(this._drag,e),this._startPosMouseArgs=null,this._drag=null,this._scrollAreaClickOrDragStarted=!1,this._startedDragWithCtrl=!1,this._startedDragWithShiftKey=!1,this._selectionRect=null,this._clickTimeout=null,this._scrollStartPos=null,this._isPanStarted=!1,this._clickAllowed=!1,this._stopAutoPan()}},{key:"_clickTimeoutIsOver",value:function(){return!!(this._clickTimeout&&Date.now()-this._clickTimeout>this._consts.clickDetectionMs)}},{key:"_checkUpdateSpeedTooFast",value:function(){return!!(this._autoPanLastActionDate&&Date.now()-this._autoPanLastActionDate<=this._consts.autoPanSpeedLimit)||(this._autoPanLastActionDate=Date.now(),!1)}},{key:"_scrollByPan",value:function(e,t,n){if(e&&t&&this._scrollContainer){var o=0,r=0;n&&(o=n.x,r=n.y);var i=Math.round(e.x-t.x),l=o+i;i>0&&this._rescaleInternal(l+this._canvasClientWidth()),i>0&&l+this._canvasClientWidth()>=this._scrollContainer.scrollWidth-5?this.scrollLeft=this._scrollContainer.scrollWidth:this.scrollLeft=l,!0!==this._options.disableScrollY&&(this.scrollTop=Math.round(r+e.y-t.y))}}},{key:"_scrollBySelectionOutOfBounds",value:function(e){if(!this._scrollContainer)return!1;var t=e.x,n=e.y,o=!1,r=0,i=0,l=this._consts.autoPanByScrollPadding,a=t<=l,s=t>=this._canvasClientWidth()-l,u=n<=l,c=n>=this._canvasClientHeight()-l,d=null,v=null;if(a||s||u||c){if(this._startAutoPan(),this._checkUpdateSpeedTooFast())return!1;var _=isNaN(this._consts.scrollByDragSpeed)?1:this._consts.scrollByDragSpeed;a?r=-f.getDistance(t,l)*_:s&&(r=f.getDistance(t,this._canvasClientWidth()-l)*_,d=this.scrollLeft+this._canvasClientWidth()+r),u?i=-f.getDistance(t,l)*_/4:c&&(i=f.getDistance(t,this._canvasClientHeight()-l)*_/4,v=this._scrollContainer.scrollTop+this._canvasClientHeight())}else this._stopAutoPan();return(d||v)&&this._rescaleInternal(d,v,we.ScrollBySelection),Math.abs(r)>0&&(this.scrollLeft=this._scrollContainer.scrollLeft+r,o=!0),Math.abs(i)>0&&!0!==this._options.disableScrollY&&(this.scrollTop=this._scrollContainer.scrollTop+i,o=!0),o}},{key:"pxToVal",value:function(e){if(!this._options)return e;var t=this._options.min||0;f.isNumber(t)||(t=0);var n=this._options.stepPx||0;return 0===n?e:(t*=this._currentZoom||1)+e/n*((this._options.stepVal||0)*this._currentZoom||1)}},{key:"snapVal",value:function(e){if(this._options&&this._options.snapEnabled&&this._options.snapStep){var t=this._options.snapStep,n=e/t,o=Math.round(n),r=Math.abs(this._options.min||0)/this._options.snapStep,i=f.sign(this._options.min||1)*(r-Math.floor(r))*this._options.snapStep;e=Math.round(i)+Math.round(o*t)}return f.keepInBounds(e,this._options.min,this._options.max)}},{key:"scrollLeft",get:function(){var e;return(null===(e=this._scrollContainer)||void 0===e?void 0:e.scrollLeft)||0},set:function(e){this._scrollContainer&&this._scrollContainer.scrollLeft!==e&&(this._scrollProgrammatically=!0,this._scrollContainer.scrollLeft=e)}},{key:"scrollTop",get:function(){var e;return(null===(e=this._scrollContainer)||void 0===e?void 0:e.scrollTop)||0},set:function(e){this._scrollContainer&&this._scrollContainer.scrollTop!==e&&(this._scrollProgrammatically=!0,this._scrollContainer.scrollTop=e)}},{key:"_isDurationLinePresent",value:function(){var e,t;return void 0!==(null===(e=this._options.timelineStyle)||void 0===e?void 0:e.durationCapStyle)||void 0!==(null===(t=this._options.timelineStyle)||void 0===t?void 0:t.durationStrokeColor)}}],o&&Te(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(i);return t})());